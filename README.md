# Notion 基金日常查看系统

这是一个自动化工具，用于计算和展示基金投资的日常收益数据，包括当日收益、持有收益、总收益和持仓成本等关键指标。

## 🎯 功能特性

- 📊 **当日收益计算** - 基于持仓和当日涨跌幅计算
- 💰 **持有收益计算** - 基于持仓成本和当前估值计算
- 📈 **总收益汇总** - 当日收益 + 持有收益
- 💵 **持仓成本管理** - 自动计算总投入成本
- 🔄 **自动数据同步** - 从两个 Notion 数据库获取数据
- 📋 **智能汇总报告** - 生成详细的收益汇总信息

## 🏗️ 系统架构

### 数据来源
- **持仓数据库** - 存储基金持仓信息和市场数据
- **交易数据库** - 存储基金买卖交易记录

### 计算字段
持仓表将自动添加以下字段：
- `当日收益` - 基于当日涨跌幅的收益
- `持有收益` - 基于持仓成本的收益
- `总收益` - 当日收益 + 持有收益
- `总持仓成本` - 累计投入成本
- `市值` - 当前持仓市值
- `收益率` - 持有收益率

## ⚙️ 环境变量配置

在环境变量中设置以下配置：

```bash
NOTION_TOKEN=your_notion_integration_token
HOLDINGS_DB_ID=your_holdings_database_id
DAILY_DATA_DB_ID=your_daily_data_database_id
```

## 🚀 使用方法

### 本地运行

```bash
# 安装依赖
pip install -r requirements.txt

# 设置环境变量
export NOTION_TOKEN="your_token"
export HOLDINGS_DB_ID="your_holdings_db_id"
export DAILY_DATA_DB_ID="your_daily_data_db_id"

# 运行脚本
python notion_fund_daily_view.py profit  # 计算所有基金收益
```

### 支持的运行模式

- `profit` - 计算并更新所有基金的收益数据（默认）

## 📋 数据库结构要求

### 持仓表 (Holdings)
必需字段：
- `基金名称` (Title) - 基金名称
- `Code` (Rich text) - 基金代码
- `单位净值` (Number) - 最新单位净值
- `估算净值` (Number) - 当日估算净值
- `估算涨跌幅` (Number) - 当日涨跌幅百分比
- `持仓成本` (Number/Formula/Rollup) - 持仓成本
- `仓位` (Number) - 仓位权重
- `持有份额` (Number) - 持有份额

### 每日数据表 (Daily Data)
必需字段：
- `日期` (Title) - 记录日期，格式如 @2024-01-15
- `当日收益` (Number) - 当日收益金额
- `持仓成本` (Number) - 总持仓成本
- `总收益` (Number) - 总收益金额

## 🔧 计算逻辑

### 当日收益
```
当日收益 = 市值 × (当日涨跌幅 ÷ 100)
```

### 持有收益
```
持有收益 = 市值 - 持仓成本
```

### 总收益
```
总收益 = 当日收益 + 持有收益
```

### 收益率
```
收益率 = (持有收益 ÷ 持仓成本) × 100%
```

## 📊 输出示例

```
[PROFIT] 000001 华夏成长 | 当日: +123.45 | 持有: +456.78 | 总收益: +580.23 | 收益率: +12.34%

============================================================
📊 基金收益汇总
============================================================
总持仓成本: ¥50,000.00
总市值: ¥56,234.56
当日收益: ¥1,234.56
持有收益: ¥6,234.56
总收益: ¥7,469.12
总收益率: +14.94%
============================================================
PROFIT Done. updated=5, failed=0, total=5
```

## ⚠️ 注意事项

- 确保 Notion 集成有足够权限访问相关数据库
- 建议在非交易时间运行，避免频繁请求
- 基金代码会自动补零到6位
- 支持从交易记录自动计算持仓份额和成本
- 所有金额计算使用四舍五入到2位小数

## 📄 许可证

MIT License
